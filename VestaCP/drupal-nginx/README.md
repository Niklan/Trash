# Drupal Nginx config for VestaCP

This guide just for apacheless version of VestaCP (php-fpm + nginx).

After installation you will have two configs for Drupal 7 and 8, but they are useless, because they handle alot of Drupal specific logic. For example, after enabling clean url's, your image style generation will break. This means, all images not created earlier will be broken, cuz of wrong logic in nginx config which not handle it. Also, you can download all files by direct input them in URL. F.e. http://domain.com/modules/block/block.module will download the file with code. It's vulnerability as is.

This config fix all this stuff, and much more. This is combination of origin vesta config and [perusio's](https://github.com/perusio/drupal-with-nginx).

This configs not replace original, it's additional, you easly can delete them if you don't like.

## Installation

1. Log in to your server as root user via ssh or sftp.
2. Navigate to `cd /usr/local/vesta/data/templates/web/nginx/php-fpm`.
3. Download config for HTTP: `wget https://raw.githubusercontent.com/Niklan/Trash/master/VestaCP/drupal-nginx/drupal-ready.tpl`
4. Download config for HTTPS: `wget https://raw.githubusercontent.com/Niklan/Trash/master/VestaCP/drupal-nginx/drupal-ready.stpl`
5. Go to VestaCP and select this config where you need it.
6. If you do it on existing domain, you must rebuild config for user. `/usr/local/vesta/bin/v-rebuild-web-domains USERNAME` where username is vestacp user which domain belongs to. It's necessary to do, or serverl will continue use config generated by previous selection. They not dynamicly changes.

You can also put this two files via SFTP and place it to folder from second step.

P.s. I'm just beginner at nginx, so my config may be not full, so you can help me to edit them.


